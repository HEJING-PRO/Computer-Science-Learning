# 第四章 对象和类

## 4.1 面向对象程序设计概述

1. 由类构造对象的过程称为创建类的实例。
2. 类之间的关系
   - 依赖：最明显、最常见的关系。一个类的方法使用或操作另一个类的对象，该对象在方法内部声明，即作为方法的临时变量。应尽可能减少相互依赖的类，即减少类之间的耦合。
   - 聚合：一个类的对象包含另一个类的对象，该对象在类中声明。
   - 继承：子类与父类的关系，子类不仅包含从父类继承的方法，还拥有额外的功能。
3. 对象：对象变量并没有实际包含一个对象，只是引用一个对象。任何对象变量的值都是对存储在另一个地方的某个对象的引用。`new`操作符只是返回一个引用。可以显示地将对象变量设置为`null`，指示该对象变量目前未引用任何对象。

## 4.2 使用预定义类

1. `LocalDate`类：不要使用构造器构造`LocalDate`类的对象，应使用静态工厂方法代表调用构造器。

   ```java
   // 构造一个对象，获取当前时间
   LocalDate.now();
   // 提供年月日构造对应一个特定日期的对象
   LocalDate.of(2023,11,03);
   ```

## 4.3 用户自定义类

1. 构造器：通常结合`new`运算符调用，不能对一个已经存在的对象调用构造器达到重新设置实例字段的目的；与类同名；每个类可存在多个构造器；无返回值。

2. 用`var`声明局部变量（Java 10）：若能从变量的初始值推导其类型，则可使用`var`关键字声明局部变量，无需指定类型。

   > 注：`var`关键字只能用于方法中的局部变量，参数和字段的类型必须声明。

3. 隐式参数和显式参数：方法参数列表中的参数为显式参数，方法的调用者为隐式参数。在每一个方法中，`this`指示方法调用的目标或接收者。

4. 访问器方法：只访问对象但不修改对象的方法；若需要返回一个可变数据字段的副本，应使用`clone`。

   > 注：不要编写返回可变对象引用的访问器方法。

5. `final`实例字段：此类字段必须在构造对象时初始化，且后续无法被修改。

## 4.4 静态字段和静态方法

1. 静态字段（类字段）：若将一个字段定义为`static`，则类只有一个这样的字段，即该类的所有实例对象共享该字段；即使没有对象，该字段依然存在；静态字段属于类，不属于单个对象。

2. 静态常量：

   ```java
   // 由于 final 修饰的变量为常量，无法修改，故可以使用 public 修饰
   public static final double PI = 3.14;
   ```

3. 静态方法：不在对象上执行的方法，通过类名直接调用，无`this`参数，可以访问静态字段。当方法不需要访问对象状态（所需参数通过显式参数提供）或只需访问类的静态字段时，使用静态方法。

4. `main`方法：每个类可以有一个`main`方法，用于对其进行单元测试。

## 4.5 方法参数

1. 按值调用：方法接收的是调用者提供的值。
2. 按引用调用：方法接收的是调用者提供的变量地址。
3. 结论
   - 方法不能修改基本数据类型的参数；
   - 方法可以改变对象参数的状态；
   - 方法不能让一个对象参数引用一个新的对象。

## 4.6 对象构造

1. 重载：多个方法有相同的名字、不同的参数（类型、顺序、名字）。利用各方法首部中的参数类型与方法调用中的使用的值类型进行匹配，选择正确的方法。查找匹配的过程称为重载解析。

2. 默认字段初始化：若构造函数未显式为字段设置初值，则自动赋为默认值，数值为$0$、布尔值为`false`、对象引用为`null`。

   > 注：方法中的局部变量必须明确地初始化，但类中的字段若未显式初始化，会进行默认初始化。

3. 无参数的构造器：由无参构造器创建对象时，对象的状态设置为适当的默认值。若未编写构造器则自动提供无参构造器，若类中编写有参构造器，但未编写无参构造器，则构造对象时不提供参数将报错。

   > 注：仅当类未提供其他构造器时，才会自动提供默认的无参构造器。

4. 参数名：参数变量会屏蔽同名的实例字段，可以使用`this`访问实例字段，`this`是隐式参数，指向方法调用的目标，即所构造的对象。

   ```java
   public Person(Stirng name, int age){
       this.name = name;
       this.age = age;
   }
   ```

5. 调用另一个构造器：若构造器的第一个语句形如`this(...)`，则构造器将调用同类的另一个构造器。

   ```java
   public Person(String name){
       this("Mike", 12);
   }
   ```

6. 初始化块：若类的静态字段需要很复杂的初始化代码，则可使用静态初始化块。

   ```java
   static{
       ...
   }
   ```

7. 对象析构和`finalize`方法：Java 会自动完成垃圾回收，故不存在析构函数。不要使用`finalize`方法完成清理，无法与之其具体调用时间。


## 4.7 包

1. 包名：用于确保类名的唯一性，若同名的类位于不同的包中，则不会产生冲突。

   > 注：从编译器的角度看，嵌套的包之间没有任何关系，如`java.util`包与`java.util.jar`包毫无关系，每个包均为独立的类的集合

2. 类的导入：一个类可以使用所属保重的所有类，以及其他包中的公共类。可以使用`import`语句导入一个特定的类或者整个包；只能使用`*`导入一个包（`import java.util.*`），不能使用`import java.*`导入以`java`为前缀的所有包；当连个包中包含同名类时，可以使用特定的`import`语句解决或者在使用时在类名前使用完整的报名引用其他类。

   ```java
   import java.util.*;
   import java.sql.*;
   import java.util.Date;
   
   // 使用完整的包名
   Date today = new java.util.Date();
   ```

3. 静态导入：导入静态方法或静态字段。

   ```java
   import static java.lang.System.*;
   ```

4. 在包中增加类：若需将类放入包中，必须将包的名字放入源文件的开头，若在源文件中无`package`语句，则源文件所在的类属于无名包。

   ```java
   package ...
   ```

5. 访问修饰符

   - `public`：可以被任意类访问；
   - `private`：只能由定义它们的类访问；
   - `protected`：可由同一包中的所有方法访问。


## 4.8 JAR 文件



## 4.9 文档注释

1. `javadoc`实用工具从以下项目中抽取信息：模块、包、公共类与接口、公共的和受保护的字段、公共的和受保护的构造器及方法，为以上特性添加文档注释（`/** */`）。

2. 类注释：必须放在`import`语句之后，类定义之前。

3. 方法注释：放在所描述的方法之前，除通用标记外，可使用以下标记。

   ```java
   /**
     * @param：参数描述
     * @return：返回值描述
     * @throws：抛出错误的描述
   */
   ```

4. 字段注释：只需对公共字段建立文档，通常为静态常量。

5. 包注释：需要为每个包目录添加一个单独的文件，有以下两种方法

   - 提供一个名为`package-info.java`的文件，必须包含一个初始的以`/***/`界定的注释，后面是一个`package`语句，不能包含更多的代码和注释。
   - 提供一个名为`package.html`的文件，会抽取`<body>...</body>`之间的所有文本。

## 4.10 类设计技巧 

1. 一定要保证数据私有：最重要，绝对不可破坏封装性。
2. 一定要对数据进行初始化：Java 不会初始化局部变量，但会将对象的实例字段进行初始化，应显式初始化所有数据，可提供默认值，或在所有构造器中设置默认值。
3. 不要在类中使用过多基本类型：用其他的类替换使用多个相关的基本类型。
4. 不是所有字段都需要单独的字段访问器和字段更改器。
5. 分解有过多职责的类。
6. 类名和方法名应能够体现其职责。
7. 优先使用不可变的类。